% A testing document for the csvtabular package.
\documentclass{article}
\usepackage{booktabs}
\usepackage{csvsimple}
\usepackage{multicol}
\newcommand{\coltext}[1]{\multicolumn{1}{c}{#1}} % For column headers
\usepackage{forloop}
\usepackage{pgffor}

\newcommand{\csvtable}[6]{
	\newcounter{lastbreak}
	\newcounter{lastcolumnheight}
	\newcounter{tablerow}
	\foreach \break in {#5} {%
		\setcounter{tablerow}{0}
		\begin{tabular}[htb]{#2}
			\toprule
			#3
			\csvreader[
				before line = \\, before first line = \\ \midrule,
				after line = {\addtocounter{tablerow}{1}},
				filter={\value{csvinputline} > \arabic{lastbreak}
				        \AND \(\value{csvinputline} < \break
				        \OR \value{csvinputline} = \break\)}]
				{#1}{}{#4} \\
			\bottomrule
		\end{tabular}#6%
		\setcounter{lastbreak}{\break}
		\setcounter{lastcolumnheight}{\arabic{tablerow}}
	}%
	% Process the remaining lines
	\setcounter{tablerow}{0}
	\newcounter{blanks}
	\begin{tabular}[htb]{#2}
		\toprule
		#3
		\csvreader[
			before line = \\, before first line = \\ \midrule,
			after line = {\addtocounter{tablerow}{1}},
			filter={\value{csvinputline} > \arabic{lastbreak}}]
			{#1}{}{#4}
		% Fill in blank lines to make the tables of same height
		\forloop{blanks}{\value{tablerow}}
			{\value{blanks} < \value{lastcolumnheight}} {\\}
		\\ % Required by tabular after the forloop
		\bottomrule
	\end{tabular}
}

\begin{document}

\section{Experiment}

\newcommand{\tablekclheader}{
	\coltext{$\theta$} &
	\coltext{$R$} &
	\coltext{$C$}
	\\
	\coltext{$[\mathrm{C}]$} &
	\coltext{$[\mathrm{\Omega}]$} &
	\coltext{$[\mathrm{pF}]$}
}
\begin{table}[htp]
	\small
	\caption{Resistance and capacity of cell with KCl solution}
	\label{tab:kcl}
	\centering
	\csvtable
		{measurement-capacity.csv}
		{c c c}
		{\tablekclheader}
		{\csvcoli & \csvcolii &\csvcoliii}
		{18, 35}
% 		{27}
% 		{}
		{\quad}
\end{table}

\end{document}
