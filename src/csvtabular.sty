\usepackage{booktabs}
\usepackage{csvsimple}
\usepackage{forloop}
\usepackage{pgffor}

\newcounter{lastbreak}
\newcounter{lastcolumnheight}
\newcounter{tablerow}
\newcounter{blanks}

% TODO: Make #5 and #6 optional
% #1 - CSV filename
% #2 - columns
% #3 - header
% #4 - line
% #5 - breaks
% $6 - spacer
\newcommand{\csvtable}[6]{
	\setcounter{lastbreak}{0}
	\setcounter{lastcolumnheight}{0}
	\setcounter{tablerow}{0}
	\foreach \break in {#5} {%
		\setcounter{tablerow}{0}
		\begin{tabular}[htb]{#2}
			\toprule
			#3
			\csvreader[
				before line = \\, before first line = \\ \midrule,
				after line = {\addtocounter{tablerow}{1}},
				filter={\value{csvinputline} > \arabic{lastbreak}
				        \AND \(\value{csvinputline} < \break
				        \OR \value{csvinputline} = \break\)}]
				{#1}{}{#4} \\
			\bottomrule
		\end{tabular}#6%
		\setcounter{lastbreak}{\break}
		\setcounter{lastcolumnheight}{\arabic{tablerow}}
	}%
	% Process the remaining lines
	\setcounter{tablerow}{0}
	\setcounter{blanks}{0}
	\begin{tabular}[htb]{#2}
		\toprule
		#3
		\csvreader[
			before line = \\, before first line = \\ \midrule,
			after line = {\addtocounter{tablerow}{1}},
			filter={\value{csvinputline} > \arabic{lastbreak}}]
			{#1}{}{#4}
		% Fill in blank lines to make the tables of same height
		\forloop{blanks}{\value{tablerow}}
			{\value{blanks} < \value{lastcolumnheight}} {\\}
		\\ % Required by tabular after the forloop
		\bottomrule
	\end{tabular}
}
